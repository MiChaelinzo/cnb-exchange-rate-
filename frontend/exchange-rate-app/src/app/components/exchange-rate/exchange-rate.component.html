<div class="exchange-rate-container">
  <header class="header">
    <h1>Exchange Rates</h1>
    <p class="subtitle">Current exchange rates from Czech National Bank</p>
    @if (lastUpdated()) {
      <div class="update-info">
        <span class="update-date">Last updated: {{ lastUpdated() }}</span>
        <span class="sequence">Sequence #{{ sequenceNumber() }}</span>
      </div>
    }
  </header>

  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading exchange rates...</p>
    </div>
  }

  @if (error()) {
    <div class="error-container">
      <div class="error-message">
        <h3>Unable to load exchange rates</h3>
        <p>{{ error() }}</p>
        <button class="retry-button" (click)="retry()">
          <span class="retry-icon">↻</span>
          Try Again
        </button>
      </div>
    </div>
  }

  @if (!isLoading() && !error()) {
    <div class="search-container">
      <div class="search-box">
        <input 
          #searchInput
          type="text" 
          placeholder="Search by country, currency, or code..." 
          [value]="searchTerm()"
          (input)="onSearchChange(searchInput.value)"
          class="search-input"
          aria-label="Search exchange rates"
        />
        @if (searchTerm()) {
          <button class="clear-button" (click)="clearSearch()" aria-label="Clear search">
            ✕
          </button>
        }
      </div>
      <div class="results-info">
        Showing {{ exchangeRates().length }} of {{ allRates().length }} currencies
      </div>
    </div>

    @if (exchangeRates().length > 0) {
      <div class="table-container">
        <table class="exchange-rate-table">
          <thead>
            <tr>
              <th class="sortable" (click)="sortBy('country')">
                Country
                @if (sortField() === 'country') {
                  <span class="sort-indicator">{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span>
                }
              </th>
              <th class="sortable" (click)="sortBy('currency')">
                Currency
                @if (sortField() === 'currency') {
                  <span class="sort-indicator">{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span>
                }
              </th>
              <th class="amount-column">Amount</th>
              <th class="code-column sortable" (click)="sortBy('code')">
                Code
                @if (sortField() === 'code') {
                  <span class="sort-indicator">{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span>
                }
              </th>
              <th class="rate-column sortable" (click)="sortBy('rate')">
                Rate (CZK)
                @if (sortField() === 'rate') {
                  <span class="sort-indicator">{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span>
                }
              </th>
            </tr>
          </thead>
          <tbody>
            @for (rate of exchangeRates(); track rate.code) {
              <tr>
                <td class="country-cell">{{ rate.country }}</td>
                <td class="currency-cell">{{ rate.currency }}</td>
                <td class="amount-cell">{{ rate.amount }}</td>
                <td class="code-cell">
                  <span class="currency-code">{{ rate.code }}</span>
                </td>
                <td class="rate-cell">{{ rate.rate | number:'1.3-3' }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="no-results-container">
        <p>No currencies match your search "{{ searchTerm() }}"</p>
        <button class="retry-button" (click)="clearSearch()">Clear Search</button>
      </div>
    }
  }

  @if (!isLoading() && !error() && exchangeRates().length === 0) {
    <div class="no-data-container">
      <p>No exchange rates available at the moment.</p>
      <button class="retry-button" (click)="retry()">
        <span class="retry-icon">↻</span>
        Refresh
      </button>
    </div>
  }
</div>